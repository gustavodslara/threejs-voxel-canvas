<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title data-i18n="app.title">Voxel Canvas - Three.js</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="public/assets/images/threejs-pixel-canvas-logo.png"
    />

    <meta
      name="description"
      content="Paint in 3D space with custom colors"
      data-i18n-content="app.description"
    />

    <script src="https://cdn.tailwindcss.com"></script>

    <script
      async
      src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"
    ></script>

    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@v0.154.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@v0.154.0/examples/jsm/",
          "i18n": "./public/js/i18n.js"
        }
      }
    </script>

    <link rel="stylesheet" href="public/css/main.css" />
  </head>
  <body class="m-0 overflow-hidden">
    <div
      id="color-toolbar"
      class="absolute top-0 left-0 bottom-0 w-16 bg-gray-900/80 backdrop-blur-sm flex flex-col items-center py-4 overflow-y-auto overflow-x-hidden"
      data-i18n-title="toolbar.colorPalette"
    >
      <div class="flex flex-col gap-2 w-full px-2 items-center">
        <button
          id="gray"
          class="color-button selected w-12 h-12 border-none rounded-lg cursor-pointer transition-all duration-200 hover:scale-110 flex-shrink-0"
          style="background-color: gray"
          onclick="setColor(event)"
          data-i18n-title="colors.gray"
        ></button>
        <button
          id="white"
          class="color-button w-12 h-12 border-none rounded-lg cursor-pointer transition-all duration-200 hover:scale-110 ring-1 ring-gray-300 flex-shrink-0"
          style="background-color: white"
          onclick="setColor(event)"
          data-i18n-title="colors.white"
        ></button>
        <button
          id="red"
          class="color-button w-12 h-12 border-none rounded-lg cursor-pointer transition-all duration-200 hover:scale-110 flex-shrink-0"
          style="background-color: red"
          onclick="setColor(event)"
          data-i18n-title="colors.red"
        ></button>
        <button
          id="orange"
          class="color-button w-12 h-12 border-none rounded-lg cursor-pointer transition-all duration-200 hover:scale-110 flex-shrink-0"
          style="background-color: orange"
          onclick="setColor(event)"
          data-i18n-title="colors.orange"
        ></button>
        <button
          id="yellow"
          class="color-button w-12 h-12 border-none rounded-lg cursor-pointer transition-all duration-200 hover:scale-110 flex-shrink-0"
          style="background-color: yellow"
          onclick="setColor(event)"
          data-i18n-title="colors.yellow"
        ></button>
        <button
          id="green"
          class="color-button w-12 h-12 border-none rounded-lg cursor-pointer transition-all duration-200 hover:scale-110 flex-shrink-0"
          style="background-color: green"
          onclick="setColor(event)"
          data-i18n-title="colors.green"
        ></button>
        <button
          id="blue"
          class="color-button w-12 h-12 border-none rounded-lg cursor-pointer transition-all duration-200 hover:scale-110 flex-shrink-0"
          style="background-color: blue"
          onclick="setColor(event)"
          data-i18n-title="colors.blue"
        ></button>
        <button
          id="purple"
          class="color-button w-12 h-12 border-none rounded-lg cursor-pointer transition-all duration-200 hover:scale-110 flex-shrink-0"
          style="background-color: purple"
          onclick="setColor(event)"
          data-i18n-title="colors.purple"
        ></button>
        <button
          id="pink"
          class="color-button w-12 h-12 border-none rounded-lg cursor-pointer transition-all duration-200 hover:scale-110 flex-shrink-0"
          style="background-color: hotpink"
          onclick="setColor(event)"
          data-i18n-title="colors.pink"
        ></button>

        <button
          id="add-color-btn"
          class="w-12 h-12 border-2 border-dashed border-white/50 rounded-lg cursor-pointer transition-all duration-200 hover:scale-110 hover:border-white flex items-center justify-center text-white text-2xl font-bold flex-shrink-0"
          onclick="toggleColorPicker()"
          data-i18n-title="toolbar.addColor"
        >
          +
        </button>
      </div>
    </div>

    <div
      id="action-toolbar"
      class="absolute top-4 right-4 flex flex-col gap-2 bg-gray-900/80 backdrop-blur-sm rounded-xl p-2"
    >
      <button
        id="mode-toggle-btn"
        class="w-12 h-12 border-2 border-green-500/70 rounded-lg cursor-pointer transition-all duration-200 hover:scale-110 hover:border-green-400 hover:bg-green-500/20 flex items-center justify-center text-white text-xl"
        onclick="toggleMode()"
        data-i18n-title="toolbar.toggleMode"
        title="Toggle Paint/Add Mode"
      >
        üé®
      </button>

      <button
        id="undo-btn"
        class="w-12 h-12 border-2 border-white/50 rounded-lg cursor-pointer transition-all duration-200 hover:scale-110 hover:border-white hover:bg-white/10 flex items-center justify-center text-white text-xl disabled:opacity-30 disabled:cursor-not-allowed disabled:hover:scale-100"
        onclick="undo()"
        data-i18n-title="toolbar.undo"
        disabled
      >
        ‚Ü∂
      </button>

      <button
        id="redo-btn"
        class="w-12 h-12 border-2 border-white/50 rounded-lg cursor-pointer transition-all duration-200 hover:scale-110 hover:border-white hover:bg-white/10 flex items-center justify-center text-white text-xl disabled:opacity-30 disabled:cursor-not-allowed disabled:hover:scale-100"
        onclick="redo()"
        data-i18n-title="toolbar.redo"
        disabled
      >
        ‚Ü∑
      </button>

      <div class="w-full h-px bg-white/20 my-1"></div>

      <button
        id="settings-btn"
        class="w-12 h-12 border-2 border-white/50 rounded-lg cursor-pointer transition-all duration-200 hover:scale-110 hover:border-white hover:bg-white/10 flex items-center justify-center text-white text-xl"
        onclick="toggleSettings()"
        data-i18n-title="toolbar.settings"
      >
        ‚öôÔ∏è
      </button>

      <button
        id="export-btn"
        class="w-12 h-12 border-2 border-white/50 rounded-lg cursor-pointer transition-all duration-200 hover:scale-110 hover:border-white hover:bg-white/10 flex items-center justify-center text-white text-xl"
        onclick="toggleExport()"
        data-i18n-title="toolbar.export"
      >
        üíæ
      </button>

      <button
        id="ai-generate-btn"
        class="w-12 h-12 border-2 border-purple-500/70 rounded-lg cursor-pointer transition-all duration-200 hover:scale-110 hover:border-purple-400 hover:bg-purple-500/20 flex items-center justify-center text-white text-xl"
        onclick="toggleAIPrompt()"
        data-i18n-title="toolbar.aiGenerate"
      >
        ‚ú®
      </button>
    </div>

    <div
      id="color-picker-modal"
      class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center z-50"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 transform transition-all"
      >
        <div class="flex items-center justify-between mb-6">
          <h2
            class="text-2xl font-bold text-gray-800"
            data-i18n="colorPicker.title"
          >
            Pick a Color
          </h2>
          <button
            onclick="toggleColorPicker()"
            class="text-gray-400 hover:text-gray-600 text-3xl leading-none transition-colors"
            data-i18n-title="colorPicker.close"
          >
            &times;
          </button>
        </div>

        <div class="space-y-6">
          <div class="relative">
            <input
              type="color"
              id="color-picker-input"
              class="w-full h-64 cursor-pointer rounded-xl border-4 border-gray-200"
              value="#808080"
            />
          </div>

          <div>
            <label
              class="block text-sm font-medium text-gray-700 mb-2"
              data-i18n="colorPicker.hexLabel"
              >Hex Color</label
            >
            <input
              type="text"
              id="hex-input"
              class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition-colors font-mono text-lg"
              data-i18n-placeholder="colorPicker.hexPlaceholder"
              placeholder="#808080"
              maxlength="7"
            />
          </div>

          <div>
            <label
              class="block text-sm font-medium text-gray-700 mb-3"
              data-i18n="colorPicker.actionLabel"
              >Action</label
            >
            <div class="flex gap-3">
              <button
                id="action-add"
                class="flex-1 px-4 py-3 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors action-btn selected"
                onclick="handleAddNewColor()"
                data-i18n="colorPicker.addNew"
              >
                Add New
              </button>
              <button
                id="action-replace"
                class="flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors action-btn"
                onclick="setAction('replace')"
                data-i18n="colorPicker.replace"
              >
                Replace
              </button>
            </div>
          </div>

          <div id="replace-target-container" class="hidden">
            <label
              class="block text-sm font-medium text-gray-700 mb-2"
              data-i18n="colorPicker.replaceLabel"
              >Click a color to replace it</label
            >
            <div id="replace-buttons" class="grid grid-cols-5 gap-2"></div>
          </div>
        </div>
      </div>
    </div>

    <div
      id="settings-modal"
      class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center z-50 p-4"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl w-full max-w-md mx-auto transform transition-all max-h-[80vh] flex flex-col"
      >
        <div
          class="flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0"
        >
          <h2
            class="text-2xl font-bold text-gray-800"
            data-i18n="settings.title"
          >
            Settings
          </h2>
          <button
            onclick="toggleSettings()"
            class="text-gray-400 hover:text-gray-600 text-3xl leading-none transition-colors"
            data-i18n-title="colorPicker.close"
          >
            &times;
          </button>
        </div>
        <div class="overflow-y-auto flex-1 p-6">
          <div class="space-y-6">
            <div>
              <label
                class="block text-sm font-medium text-gray-700 mb-3"
                data-i18n="settings.language"
                >Language</label
              >
              <div class="grid grid-cols-3 gap-2">
                <button
                  onclick="changeLanguage('en-US')"
                  class="lang-btn px-4 py-3 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all"
                  data-lang="en-US"
                >
                  üá∫üá∏ English
                </button>
                <button
                  onclick="changeLanguage('pt-BR')"
                  class="lang-btn px-4 py-3 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all"
                  data-lang="pt-BR"
                >
                  üáßüá∑ Portugu√™s
                </button>
                <button
                  onclick="changeLanguage('es-ES')"
                  class="lang-btn px-4 py-3 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all"
                  data-lang="es-ES"
                >
                  üá™üá∏ Espa√±ol
                </button>
                <button
                  onclick="changeLanguage('fr-FR')"
                  class="lang-btn px-4 py-3 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all"
                  data-lang="fr-FR"
                >
                  üá´üá∑ Fran√ßais
                </button>
                <button
                  onclick="changeLanguage('de-DE')"
                  class="lang-btn px-4 py-3 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all"
                  data-lang="de-DE"
                >
                  üá©üá™ Deutsch
                </button>
                <button
                  onclick="changeLanguage('ja-JP')"
                  class="lang-btn px-4 py-3 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all"
                  data-lang="ja-JP"
                >
                  üáØüáµ Êó•Êú¨Ë™û
                </button>
              </div>
            </div>

            <div class="border-t border-gray-200"></div>

            <div>
              <label
                class="block text-sm font-medium text-gray-700 mb-3"
                data-i18n="settings.canvasMode"
                >Canvas Mode</label
              >
              <div class="grid grid-cols-2 gap-3">
                <button
                  id="settings-mode-2d"
                  onclick="setSettingsMode('2d')"
                  class="px-4 py-3 border-2 border-blue-500 bg-blue-500 text-white rounded-lg font-semibold transition-all hover:scale-105"
                >
                  <span data-i18n="settings.mode2D">üñºÔ∏è 2D Grid</span>
                </button>
                <button
                  id="settings-mode-3d"
                  onclick="setSettingsMode('3d')"
                  class="px-4 py-3 border-2 border-gray-300 bg-white text-gray-700 rounded-lg font-semibold transition-all hover:scale-105 hover:border-blue-300"
                >
                  <span data-i18n="settings.mode3D">üßä 3D Voxels</span>
                </button>
              </div>
            </div>

            <div id="settings-2d-config" class="space-y-4">
              <label
                class="block text-sm font-medium text-gray-700 mb-2"
                data-i18n="settings.gridSize"
                >Grid Size (2D Canvas)</label
              >
              <p
                class="text-xs text-gray-500 mb-3"
                data-i18n="settings.gridSizeHelp"
              >
                Changes the number of pixels in your canvas
              </p>

              <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-4">
                <p
                  class="text-xs text-yellow-700"
                  data-i18n="settings.gridWarning"
                >
                  ‚ö†Ô∏è Warning: Changing grid size will clear your artwork!
                </p>
              </div>

              <div class="bg-blue-50 border-l-4 border-blue-400 p-3">
                <p
                  class="text-xs text-blue-700 font-semibold mb-2"
                  data-i18n="settings.gridDimensions"
                >
                  Grid Dimensions
                </p>
                <div class="grid grid-cols-2 gap-2 mb-3">
                  <div>
                    <label
                      class="text-xs text-gray-600"
                      data-i18n="settings.width"
                      >Width (X)</label
                    >
                    <input
                      type="number"
                      id="grid-width"
                      min="4"
                      max="128"
                      value="8"
                      class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                    />
                  </div>
                  <div>
                    <label
                      class="text-xs text-gray-600"
                      data-i18n="settings.height"
                      >Height (Y)</label
                    >
                    <input
                      type="number"
                      id="grid-height"
                      min="4"
                      max="128"
                      value="8"
                      class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                    />
                  </div>
                </div>

                <div
                  class="text-xs text-gray-500 mb-2"
                  data-i18n="settings.presets"
                >
                  Quick Presets:
                </div>
                <div class="grid grid-cols-2 gap-2 mb-3">
                  <button
                    onclick="setGridDimensions(8, 8)"
                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-xs font-medium transition-colors"
                    data-i18n="settings.preset8x8"
                  >
                    8x8 - Tiny
                  </button>
                  <button
                    onclick="setGridDimensions(16, 16)"
                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-xs font-medium transition-colors"
                    data-i18n="settings.preset16x16"
                  >
                    16x16 - Small
                  </button>
                  <button
                    onclick="setGridDimensions(32, 32)"
                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-xs font-medium transition-colors"
                    data-i18n="settings.preset32x32"
                  >
                    32x32 - Medium
                  </button>
                  <button
                    onclick="setGridDimensions(64, 64)"
                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-xs font-medium transition-colors"
                    data-i18n="settings.preset64x64"
                  >
                    64x64 - Large
                  </button>
                </div>

                <button
                  onclick="applyCustomGridSize()"
                  class="w-full bg-blue-500 text-white py-2 rounded-lg font-medium hover:bg-blue-600 transition-colors"
                  data-i18n="settings.apply"
                >
                  Apply Grid Size
                </button>
              </div>
            </div>

            <div id="settings-3d-config" class="hidden space-y-4">
              <label
                class="block text-sm font-medium text-gray-700 mb-2"
                data-i18n="settings.voxelSize"
                >Voxel Space Size (3D Canvas)</label
              >
              <p
                class="text-xs text-gray-500 mb-3"
                data-i18n="settings.voxelSizeHelp"
              >
                Changes the 3D voxel space dimensions
              </p>

              <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-4">
                <p
                  class="text-xs text-yellow-700"
                  data-i18n="settings.gridWarning"
                >
                  ‚ö†Ô∏è Warning: Changing size will clear your artwork!
                </p>
              </div>

              <div class="bg-indigo-50 border-l-4 border-indigo-400 p-3">
                <p
                  class="text-xs text-indigo-700 font-semibold mb-2"
                  data-i18n="settings.voxelDimensions"
                >
                  Voxel Space Dimensions
                </p>
                <div class="grid grid-cols-3 gap-2 mb-3">
                  <div>
                    <label
                      class="text-xs text-gray-600"
                      data-i18n="settings.width"
                      >Width (X)</label
                    >
                    <input
                      type="number"
                      id="voxel-width"
                      min="4"
                      max="64"
                      value="16"
                      class="w-full px-2 py-1 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500 text-sm"
                    />
                  </div>
                  <div>
                    <label
                      class="text-xs text-gray-600"
                      data-i18n="settings.height"
                      >Height (Y)</label
                    >
                    <input
                      type="number"
                      id="voxel-height"
                      min="4"
                      max="64"
                      value="16"
                      class="w-full px-2 py-1 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500 text-sm"
                    />
                  </div>
                  <div>
                    <label
                      class="text-xs text-gray-600"
                      data-i18n="settings.depth"
                      >Depth (Z)</label
                    >
                    <input
                      type="number"
                      id="voxel-depth"
                      min="4"
                      max="64"
                      value="16"
                      class="w-full px-2 py-1 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500 text-sm"
                    />
                  </div>
                </div>

                <div
                  class="text-xs text-gray-500 mb-2"
                  data-i18n="settings.presets"
                >
                  Quick Presets:
                </div>
                <div class="grid grid-cols-2 gap-2 mb-3">
                  <button
                    onclick="setVoxelDimensions(8, 8, 8)"
                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-xs font-medium transition-colors"
                    data-i18n="settings.preset8x8x8"
                  >
                    8x8x8 - Tiny
                  </button>
                  <button
                    onclick="setVoxelDimensions(16, 16, 16)"
                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-xs font-medium transition-colors"
                    data-i18n="settings.preset16x16x16"
                  >
                    16x16x16 - Small
                  </button>
                  <button
                    onclick="setVoxelDimensions(24, 24, 24)"
                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-xs font-medium transition-colors"
                    data-i18n="settings.preset24x24x24"
                  >
                    24x24x24 - Medium
                  </button>
                  <button
                    onclick="setVoxelDimensions(32, 32, 32)"
                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-xs font-medium transition-colors"
                    data-i18n="settings.preset32x32x32"
                  >
                    32x32x32 - Large
                  </button>
                </div>

                <button
                  onclick="applyCustomVoxelSize()"
                  class="w-full bg-indigo-500 text-white py-2 rounded-lg font-medium hover:bg-indigo-600 transition-colors"
                  data-i18n="settings.applyVoxel"
                >
                  Apply Voxel Size
                </button>
              </div>
            </div>

            <div class="mt-6 pt-6 border-t border-gray-200">
              <label
                class="block text-sm font-medium text-gray-700 mb-3"
                data-i18n="settings.aiConfiguration"
                >AI Configuration</label
              >
              <p
                class="text-xs text-gray-500 mb-3"
                data-i18n="settings.aiConfigurationHelp"
              >
                Configure AI generation endpoint for custom or local models
              </p>

              <div class="space-y-4">
                <div>
                  <label
                    class="block text-xs font-medium text-gray-600 mb-2"
                    data-i18n="settings.aiProvider"
                    >AI Provider</label
                  >
                  <div class="grid grid-cols-2 gap-2">
                    <button
                      id="ai-provider-default"
                      onclick="setAIProvider('default')"
                      class="px-4 py-2 border-2 border-blue-500 bg-blue-500 text-white rounded-lg font-medium transition-all text-sm"
                    >
                      <span data-i18n="settings.aiProviderDefault"
                        >System Default</span
                      >
                    </button>
                    <button
                      id="ai-provider-custom"
                      onclick="setAIProvider('custom')"
                      class="px-4 py-2 border-2 border-gray-300 bg-white text-gray-700 rounded-lg font-medium transition-all text-sm hover:border-blue-300"
                    >
                      <span data-i18n="settings.aiProviderCustom">Custom</span>
                    </button>
                  </div>
                </div>

                <div id="custom-ai-settings" class="hidden space-y-3">
                  <div class="bg-blue-50 border-l-4 border-blue-400 p-3">
                    <p
                      class="text-xs text-blue-700"
                      data-i18n="settings.customAIInfo"
                    >
                      üí° Configure your own AI endpoint (local models don't
                      require API key)
                    </p>
                  </div>

                  <div>
                    <label
                      class="block text-xs font-medium text-gray-600 mb-1"
                      data-i18n="settings.aiEndpointURL"
                      >Endpoint URL</label
                    >
                    <input
                      type="text"
                      id="custom-ai-url"
                      class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 text-sm"
                      data-i18n-placeholder="settings.aiEndpointPlaceholder"
                      placeholder="http://localhost:1234/v1/chat/completions"
                    />
                  </div>

                  <div>
                    <label
                      class="block text-xs font-medium text-gray-600 mb-1"
                      data-i18n="settings.aiAPIKey"
                      >API Key (Optional)</label
                    >
                    <input
                      type="password"
                      id="custom-ai-key"
                      class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 text-sm"
                      data-i18n-placeholder="settings.aiAPIKeyPlaceholder"
                      placeholder="Leave empty for local models"
                    />
                  </div>

                  <button
                    onclick="saveCustomAIConfig()"
                    class="w-full bg-green-500 text-white py-2 rounded-lg font-medium hover:bg-green-600 transition-colors text-sm flex items-center justify-center gap-2"
                  >
                    <span>üíæ</span>
                    <span data-i18n="settings.saveAIConfig"
                      >Save AI Configuration</span
                    >
                  </button>
                </div>
              </div>
            </div>

            <div class="mt-6 pt-6 border-t border-gray-200">
              <label
                class="block text-sm font-medium text-gray-700 mb-3"
                data-i18n="settings.session"
                >Session</label
              >
              <p
                class="text-xs text-gray-500 mb-3"
                data-i18n="settings.startAgainHelp"
              >
                Clear your current work and start with a fresh canvas
              </p>
              <button
                onclick="startAgain()"
                class="w-full bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition-colors flex items-center justify-center gap-2"
              >
                <span>üîÑ</span>
                <span data-i18n="settings.startAgain">Start Again</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      id="export-modal"
      class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center z-50"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 transform transition-all max-h-[90vh] overflow-y-auto"
      >
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800" data-i18n="export.title">
            Export Artwork
          </h2>
          <button
            onclick="toggleExport()"
            class="text-gray-400 hover:text-gray-600 text-3xl leading-none transition-colors"
            data-i18n-title="colorPicker.close"
          >
            &times;
          </button>
        </div>

        <div class="space-y-6">
          <div>
            <label
              class="block text-sm font-medium text-gray-700 mb-3"
              data-i18n="export.exportType"
              >Export Type</label
            >
            <div class="grid grid-cols-2 gap-3">
              <button
                id="export-type-image"
                onclick="setExportType('image')"
                class="px-4 py-3 border-2 border-blue-500 bg-blue-500 text-white rounded-lg font-semibold transition-all hover:scale-105"
              >
                <span data-i18n="export.typeImage">üñºÔ∏è Image</span>
              </button>
              <button
                id="export-type-3d"
                onclick="setExportType('3d')"
                class="px-4 py-3 border-2 border-gray-300 bg-white text-gray-700 rounded-lg font-semibold transition-all hover:scale-105 hover:border-blue-300"
              >
                <span data-i18n="export.type3D">üßä 3D Model</span>
              </button>
            </div>
          </div>

          <div>
            <label
              class="block text-sm font-medium text-gray-700 mb-2"
              data-i18n="export.fileName"
              >File Name</label
            >
            <input
              type="text"
              id="export-filename"
              class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
              data-i18n-placeholder="export.fileNamePlaceholder"
              placeholder="my-pixel-art"
              value="pixel-art-3d"
            />
          </div>

          <div id="image-export-settings" class="space-y-4">
            <div>
              <label
                class="block text-sm font-medium text-gray-700 mb-2"
                data-i18n="export.resolution"
                >Export Resolution</label
              >
              <p
                class="text-xs text-gray-500 mb-3"
                data-i18n="export.resolutionHelp"
              >
                Higher resolution = larger file size
              </p>
              <select
                id="export-resolution"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 cursor-pointer"
              >
                <option value="1">1x - Original Size</option>
                <option value="2" selected>2x - Standard</option>
                <option value="4">4x - High Quality</option>
                <option value="8">8x - Ultra High</option>
              </select>
            </div>

            <div id="jpg-quality-container" class="hidden">
              <label
                class="block text-sm font-medium text-gray-700 mb-2"
                data-i18n="export.quality"
                >Quality</label
              >
              <input
                type="range"
                id="jpg-quality"
                min="0.1"
                max="1"
                step="0.05"
                value="0.92"
                class="w-full"
              />
              <div class="flex justify-between text-xs text-gray-500">
                <span>Lower</span>
                <span id="quality-value">92%</span>
                <span>Higher</span>
              </div>
            </div>

            <div class="flex gap-3">
              <button
                onclick="exportArtwork('png')"
                class="flex-1 bg-gradient-to-r from-blue-500 to-cyan-500 text-white py-4 rounded-xl font-bold hover:from-blue-600 hover:to-cyan-600 transition-all transform hover:scale-105 shadow-lg"
                data-i18n="export.exportPNG"
              >
                Export as PNG
              </button>
              <button
                onclick="exportArtwork('jpg')"
                class="flex-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white py-4 rounded-xl font-bold hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-105 shadow-lg"
                data-i18n="export.exportJPG"
              >
                Export as JPG
              </button>
            </div>
          </div>

          <div id="3d-export-settings" class="hidden space-y-4">
            <div class="bg-indigo-50 border-l-4 border-indigo-400 p-3">
              <p class="text-xs text-indigo-700" data-i18n="export.3dInfo">
                üí° Export your voxel art as a 3D model file that can be used in
                other 3D software, game engines, or 3D printing.
              </p>
            </div>

            <div class="space-y-3">
              <button
                onclick="export3DModel('glb')"
                class="w-full bg-gradient-to-r from-green-500 to-emerald-500 text-white py-4 rounded-xl font-bold hover:from-green-600 hover:to-emerald-600 transition-all transform hover:scale-105 shadow-lg flex items-center justify-center gap-2"
              >
                <span>üì¶</span>
                <span data-i18n="export.exportGLB">Export as GLB</span>
              </button>

              <button
                onclick="export3DModel('obj')"
                class="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-4 rounded-xl font-bold hover:from-orange-600 hover:to-red-600 transition-all transform hover:scale-105 shadow-lg flex items-center justify-center gap-2"
              >
                <span>üìê</span>
                <span data-i18n="export.exportOBJ">Export as OBJ</span>
              </button>

              <button
                onclick="export3DModel('stl')"
                class="w-full bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-4 rounded-xl font-bold hover:from-blue-600 hover:to-indigo-600 transition-all transform hover:scale-105 shadow-lg flex items-center justify-center gap-2"
              >
                <span>üñ®Ô∏è</span>
                <span data-i18n="export.exportSTL">Export as STL</span>
              </button>
            </div>

            <div class="bg-blue-50 border-l-4 border-blue-400 p-3">
              <p
                class="text-xs text-blue-700 font-semibold mb-1"
                data-i18n="export.formatInfo"
              >
                Format Information:
              </p>
              <ul class="text-xs text-blue-600 space-y-1">
                <li data-i18n="export.glbInfo">
                  ‚Ä¢ GLB: Best for game engines (Unity, Unreal)
                </li>
                <li data-i18n="export.objInfo">
                  ‚Ä¢ OBJ: Universal format for 3D software
                </li>
                <li data-i18n="export.stlInfo">‚Ä¢ STL: Ideal for 3D printing</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      id="ai-prompt-modal"
      class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center z-50"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl p-8 max-w-lg w-full mx-4 transform transition-all max-h-[90vh] overflow-y-auto"
      >
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
            <span class="text-2xl">‚ú®</span>
            <span data-i18n="aiPrompt.title">AI Generate Art</span>
          </h2>
          <button
            onclick="toggleAIPrompt()"
            class="text-gray-400 hover:text-gray-600 text-3xl leading-none transition-colors"
            data-i18n-title="colorPicker.close"
          >
            &times;
          </button>
        </div>

        <div class="space-y-6">
          <div>
            <label
              class="block text-sm font-medium text-gray-700 mb-3"
              data-i18n="aiPrompt.generationMode"
              >Generation Mode</label
            >
            <div class="grid grid-cols-2 gap-3">
              <button
                id="ai-mode-2d"
                onclick="setAIMode('2d')"
                class="px-4 py-3 border-2 border-purple-500 bg-purple-500 text-white rounded-lg font-semibold transition-all hover:scale-105"
              >
                <span data-i18n="aiPrompt.mode2D">üñºÔ∏è 2D Grid</span>
              </button>
              <button
                id="ai-mode-3d"
                onclick="setAIMode('3d')"
                class="px-4 py-3 border-2 border-gray-300 bg-white text-gray-700 rounded-lg font-semibold transition-all hover:scale-105 hover:border-purple-300"
              >
                <span data-i18n="aiPrompt.mode3D">üßä 3D Voxels</span>
              </button>
            </div>
          </div>

          <div id="ai-2d-info" class="space-y-4">
            <div class="bg-blue-50 border-l-4 border-blue-400 p-3">
              <p
                class="text-xs text-blue-700 font-semibold mb-2"
                data-i18n="aiPrompt.gridDimensions"
              >
                2D Grid Dimensions
              </p>
              <div class="grid grid-cols-2 gap-2">
                <div>
                  <label
                    class="text-xs text-gray-600"
                    data-i18n="aiPrompt.gridWidth"
                    >Width (X)</label
                  >
                  <input
                    type="number"
                    id="ai-grid-width"
                    value="8"
                    min="4"
                    max="128"
                    class="w-full px-2 py-1 border rounded text-sm"
                  />
                </div>
                <div>
                  <label
                    class="text-xs text-gray-600"
                    data-i18n="aiPrompt.gridHeight"
                    >Height (Y)</label
                  >
                  <input
                    type="number"
                    id="ai-grid-height"
                    value="8"
                    min="4"
                    max="128"
                    class="w-full px-2 py-1 border rounded text-sm"
                  />
                </div>
              </div>
              <p
                class="text-xs text-blue-600 mt-2"
                data-i18n="aiPrompt.gridTip"
              >
                üí° Recommended sizes: 8x8 to 32x32 for best results
              </p>
            </div>
          </div>

          <div id="ai-3d-settings" class="hidden space-y-4">
            <div class="bg-indigo-50 border-l-4 border-indigo-400 p-3">
              <p
                class="text-xs text-indigo-700 font-semibold mb-2"
                data-i18n="aiPrompt.voxelDimensions"
              >
                3D Voxel Dimensions
              </p>
              <div class="grid grid-cols-3 gap-2">
                <div>
                  <label
                    class="text-xs text-gray-600"
                    data-i18n="aiPrompt.voxelWidth"
                    >Width (X)</label
                  >
                  <input
                    type="number"
                    id="ai-voxel-width"
                    value="8"
                    min="4"
                    max="24"
                    class="w-full px-2 py-1 border rounded text-sm"
                  />
                </div>
                <div>
                  <label
                    class="text-xs text-gray-600"
                    data-i18n="aiPrompt.voxelHeight"
                    >Height (Y)</label
                  >
                  <input
                    type="number"
                    id="ai-voxel-height"
                    value="8"
                    min="4"
                    max="24"
                    class="w-full px-2 py-1 border rounded text-sm"
                  />
                </div>
                <div>
                  <label
                    class="text-xs text-gray-600"
                    data-i18n="aiPrompt.voxelDepth"
                    >Depth (Z)</label
                  >
                  <input
                    type="number"
                    id="ai-voxel-depth"
                    value="8"
                    min="4"
                    max="24"
                    class="w-full px-2 py-1 border rounded text-sm"
                  />
                </div>
              </div>
              <p
                class="text-xs text-indigo-600 mt-2"
                data-i18n="aiPrompt.voxelTip"
              >
                üí° Smaller sizes generate faster (8x8x8 recommended)
              </p>
            </div>
          </div>

          <div>
            <label
              class="block text-sm font-medium text-gray-700 mb-2"
              data-i18n="aiPrompt.promptLabel"
              >Describe what you want to create</label
            >
            <textarea
              id="ai-prompt-input"
              rows="4"
              class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-500 resize-none"
              data-i18n-placeholder="aiPrompt.promptPlaceholder"
              placeholder="A cute pixel art cat with blue eyes..."
            ></textarea>
          </div>

          <div id="ai-loading" class="hidden text-center py-4">
            <div
              class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"
            ></div>
            <p
              class="text-sm text-gray-600 mt-2"
              data-i18n="aiPrompt.generating"
            >
              Generating your art...
            </p>
          </div>

          <button
            id="ai-generate-button"
            onclick="generateWithAI()"
            class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-4 rounded-xl font-bold hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-105 shadow-lg"
            data-i18n="aiPrompt.generate"
          >
            Generate with AI ‚ú®
          </button>

          <div class="bg-purple-50 border-l-4 border-purple-400 p-3">
            <p class="text-xs text-purple-700" data-i18n="aiPrompt.info">
              ‚ö†Ô∏è AI will create art based on your settings and color palette.
            </p>
          </div>
        </div>
      </div>
    </div>

    <div
      id="startup-modal"
      class="fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center z-50"
    >
      <div
        class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-2xl p-8 max-w-2xl w-full mx-4 transform transition-all border-2 border-purple-500/30"
      >
        <div class="text-center mb-8">
          <div class="flex items-center justify-center gap-3 mb-4">
            <img
              src="public/assets/images/threejs-pixel-canvas-logo.png"
              alt="Logo"
              class="w-12 h-12 sm:w-16 sm:h-16 md:w-20 md:h-20 object-contain"
            />
            <img
              src="public/assets/images/pixel-canvas-title.png"
              alt="Pixel Canvas"
              class="h-8 sm:h-10 md:h-12 w-auto object-contain"
            />
          </div>
          <p class="text-gray-300" data-i18n="startup.chooseCanvas">
            Choose your canvas to start creating
          </p>
        </div>

        <div class="grid md:grid-cols-2 gap-4 mb-6">
          <div
            class="bg-gray-800/50 rounded-xl p-6 border-2 border-transparent hover:border-purple-500 transition-all cursor-pointer group"
            onclick="startMode('single')"
          >
            <div class="text-center">
              <div class="text-6xl mb-4">üßä</div>
              <h3
                class="text-xl font-bold text-white mb-2"
                data-i18n="startup.singleCubeTitle"
              >
                Single Cube
              </h3>
              <p
                class="text-sm text-gray-400 mb-4"
                data-i18n="startup.singleCubeDesc"
              >
                Start with one cube and build your 3D masterpiece
              </p>
              <div
                class="bg-purple-500/20 text-purple-300 px-4 py-2 rounded-lg text-sm group-hover:bg-purple-500 group-hover:text-white transition-all"
                data-i18n="startup.startBuilding"
              >
                Start Building
              </div>
            </div>
          </div>

          <div
            class="bg-gray-800/50 rounded-xl p-6 border-2 border-transparent hover:border-blue-500 transition-all cursor-pointer group"
            onclick="toggleGridSizeSelection()"
          >
            <div class="text-center">
              <div class="text-6xl mb-4">üé®</div>
              <h3
                class="text-xl font-bold text-white mb-2"
                data-i18n="startup.gridCanvasTitle"
              >
                Grid Canvas
              </h3>
              <p
                class="text-sm text-gray-400 mb-4"
                data-i18n="startup.gridCanvasDesc"
              >
                Start with a flat grid for pixel art
              </p>
              <div
                class="bg-blue-500/20 text-blue-300 px-4 py-2 rounded-lg text-sm group-hover:bg-blue-500 group-hover:text-white transition-all"
                data-i18n="startup.chooseSize"
              >
                Choose Size
              </div>
            </div>
          </div>
        </div>

        <div id="grid-size-selection" class="hidden">
          <div
            class="bg-gray-800/50 rounded-xl p-6 border-2 border-blue-500/50"
          >
            <h3
              class="text-lg font-bold text-white mb-4 text-center"
              data-i18n="startup.selectGridSize"
            >
              Select Grid Size
            </h3>
            <div class="grid grid-cols-2 gap-3">
              <button
                onclick="startMode('grid', 8, 8)"
                class="bg-gray-700 hover:bg-blue-600 text-white py-3 rounded-lg font-medium transition-all"
                data-i18n="startup.grid8x8"
              >
                8x8 - Tiny
              </button>
              <button
                onclick="startMode('grid', 16, 16)"
                class="bg-gray-700 hover:bg-blue-600 text-white py-3 rounded-lg font-medium transition-all"
                data-i18n="startup.grid16x16"
              >
                16x16 - Small
              </button>
              <button
                onclick="startMode('grid', 32, 32)"
                class="bg-gray-700 hover:bg-blue-600 text-white py-3 rounded-lg font-medium transition-all"
                data-i18n="startup.grid32x32"
              >
                32x32 - Medium
              </button>
              <button
                onclick="startMode('grid', 64, 64)"
                class="bg-gray-700 hover:bg-blue-600 text-white py-3 rounded-lg font-medium transition-all"
                data-i18n="startup.grid64x64"
              >
                64x64 - Large
              </button>
            </div>
            <button
              onclick="toggleGridSizeSelection()"
              class="w-full mt-3 bg-gray-600 hover:bg-gray-500 text-white py-2 rounded-lg text-sm transition-all"
              data-i18n="startup.back"
            >
              ‚Üê Back
            </button>
          </div>
        </div>

        <div class="mt-6 bg-blue-500/10 border-l-4 border-blue-500 p-4 rounded">
          <p class="text-sm text-blue-200" data-i18n="startup.tip">
            <strong>üí° Tip:</strong> Use <strong>Paint Mode</strong> to color
            cubes and <strong>Add Mode</strong> to place new cubes in 3D space!
          </p>
        </div>
      </div>
    </div>

    <div
      id="session-loading"
      class="hidden fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-[60]"
    >
      <div class="text-center">
        <div
          class="inline-block animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-purple-500 mb-4"
        ></div>
        <h2
          class="text-2xl font-bold text-white mb-2"
          data-i18n="loading.title"
        >
          Loading Session...
        </h2>
        <p class="text-gray-300 text-sm" data-i18n="loading.message">
          Please wait while we restore your artwork
        </p>
      </div>
    </div>

    <div
      id="cookie-consent"
      class="hidden fixed bottom-0 left-0 right-0 bg-gray-900/95 backdrop-blur-md border-t-2 border-purple-500/30 p-4 md:p-6 z-50 shadow-2xl"
    >
      <div class="max-w-6xl mx-auto">
        <div
          class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4"
        >
          <div class="flex-1">
            <h3
              class="text-lg font-bold text-white mb-2"
              data-i18n="cookies.title"
            >
              üç™ We Use Cookies
            </h3>
            <p
              class="text-sm text-gray-300 leading-relaxed"
              data-i18n="cookies.message"
            >
              We use localStorage to save your session, artwork, and
              preferences. This helps us provide you with a better experience.
              By continuing, you agree to our use of local storage.
            </p>
          </div>
          <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
            <button
              onclick="acceptCookies()"
              class="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg transition-all duration-200 hover:scale-105 shadow-lg"
              data-i18n="cookies.accept"
            >
              Accept All
            </button>
            <button
              onclick="declineCookies()"
              class="px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white font-semibold rounded-lg transition-all duration-200 hover:scale-105"
              data-i18n="cookies.decline"
            >
              Decline
            </button>
          </div>
        </div>
        <p class="text-xs text-gray-400 mt-3" data-i18n="cookies.note">
          Note: Basic functionality requires localStorage for session
          management.
        </p>
      </div>
    </div>

    <script type="module" src="public/js/main.js"></script>
  </body>
</html>
